<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ワクワク画像プレーヤー</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            overflow: hidden;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        /* 画像のスタイル */
        .target-img {
            position: absolute;
            cursor: pointer;
            width: 150px; /* サイズは適宜調整 */
            height: auto;
            transition: transform 0.2s;
            user-select: none;
        }

        .target-img:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        /* スタートボタン */
        #start-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            font-size: 24px;
            background-color: #ff4757;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
        }

        #start-btn:hover {
            background-color: #ff6b81;
        }

        /* ビデオコンテナ */
        #video-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        video {
            max-width: 80%;
            max-height: 80%;
            border: 5px solid white;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <button id="start-btn">スタート！</button>

    <div id="game-container">
        </div>

    <div id="video-overlay">
        <video id="main-video" controls></video>
    </div>

    <script>
        const config = [
            { id: 'jamboree', img: 'ジャンボリミッキー.png', video: 'jamboree.mp4' },
            { id: 'hinamatsuri', img: 'ひなまつり.png', video: 'hinamatsuri.mp4' },
            { id: 'usagi', img: 'まちぼうけうさぎ.png', video: 'usagi.mp4' },
            { id: 'ojisan', img: 'まちぼうけおじさん.png', video: 'ojisan.mp4' }
        ];

        const container = document.getElementById('game-container');
        const startBtn = document.getElementById('start-btn');
        const videoOverlay = document.getElementById('video-overlay');
        const videoPlayer = document.getElementById('main-video');
        
        let images = [];
        let isMoving = false;
        const imgSize = 150; // 画像の目安サイズ

        // --- 1. 画像の初期配置（重なり防止ロジック） ---
        function setupImages() {
            container.innerHTML = '';
            images = [];

            config.forEach(item => {
                const img = document.createElement('img');
                img.src = item.img;
                img.className = 'target-img';
                img.dataset.video = item.video;

                // 重ならない座標を計算
                let pos = getRandomPosition();
                let attempts = 0;
                while (checkOverlap(pos) && attempts < 100) {
                    pos = getRandomPosition();
                    attempts++;
                }

                img.style.left = pos.x + 'px';
                img.style.top = pos.y + 'px';

                // 移動データ
                const imgObj = {
                    element: img,
                    x: pos.x,
                    y: pos.y,
                    dx: (Math.random() - 0.5) * 4, // 速度
                    dy: (Math.random() - 0.5) * 4,
                    width: imgSize,
                    height: imgSize
                };

                img.onclick = () => playVideo(item.video);
                
                container.appendChild(img);
                images.push(imgObj);
            });
        }

        function getRandomPosition() {
            return {
                x: Math.random() * (window.innerWidth - imgSize),
                y: Math.random() * (window.innerHeight - imgSize)
            };
        }

        function checkOverlap(newPos) {
            return images.some(img => {
                const dist = Math.hypot(img.x - newPos.x, img.y - newPos.y);
                return dist < imgSize; // 画像サイズより近い場合は重なっているとみなす
            });
        }

        // --- 2. 移動アニメーション ---
        function animate() {
            if (!isMoving) return;

            images.forEach(img => {
                img.x += img.dx;
                img.y += img.dy;

                // 壁との衝突判定（跳ね返り）
                if (img.x <= 0 || img.x >= window.innerWidth - imgSize) img.dx *= -1;
                if (img.y <= 0 || img.y >= window.innerHeight - imgSize) img.dy *= -1;

                img.element.style.left = img.x + 'px';
                img.element.style.top = img.y + 'px';
            });

            requestAnimationFrame(animate);
        }

        // --- 3. イベント制御 ---
        startBtn.onclick = () => {
            startBtn.style.display = 'none';
            isMoving = true;
            setupImages();
            animate();
        };

        function playVideo(videoSrc) {
            isMoving = false;
            container.style.display = 'none';
            videoOverlay.style.display = 'flex';
            
            videoPlayer.src = videoSrc;
            videoPlayer.play();
        }

        // 再生中に画面をクリックして戻る
        videoOverlay.onclick = (e) => {
            // videoタグ自体をクリックした時は停止しないように判定
            if (e.target !== videoPlayer) {
                videoPlayer.pause();
                videoOverlay.style.display = 'none';
                container.style.display = 'block';
                isMoving = true;
                animate();
            }
        };

    </script>
</body>
</html>